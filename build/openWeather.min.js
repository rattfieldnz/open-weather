/*!

 Name: Open Weather
 Dependencies: jQuery, OpenWeatherMap API
 Author: Michael Lynch
 Author URL: http://michaelynch.com
 Date Created: August 28, 2013
 Licensed under the MIT license

 */
!function(a){a.fn.openWeather=function(b){function i(a,b,c){if(null==c)return null;var d;if("Kph"===a&&"Mph"===b)d=c/1.609344;else if("Mph"===a&&"Kph"===b)d=1.609344*c;else if("Kph"===a&&"mps"===b)d=c/3.6;else if("Mph"===a&&"mps"===b)d=.44704*c;else if("mps"===a&&"Kph"===b)d=3.6*c;else{if("mps"!==a||"Mph"!==b)return c+" "+a;d=2.23693629*c}return d.toFixed(1)+" "+b}if(!this.length)return this;var f,c={descriptionTarget:null,maxTemperatureTarget:null,minTemperatureTarget:null,windSpeedTarget:null,windDirectionTarget:null,humidityTarget:null,sunriseTarget:null,sunsetTarget:null,placeTarget:null,iconTarget:null,customIcons:null,units:"metric",windSpeedUnit:"Kph",windDirectionUnit:"compass",clickConvertWindSpeed:!0,city:null,lat:null,lng:null,key:null,lang:"en",success:function(){},error:function(a){}},d=this,e=a(this);d.settings={},d.settings=a.extend({},c,b);var g=d.settings;f="//api.openweathermap.org/data/2.5/weather?lang="+g.lang+"&units="+g.units,null!=g.city?f+="&q="+g.city.replace(" ",""):null!=g.lat&&null!=g.lng&&(f+="&lat="+g.lat+"&lon="+g.lng),null!=g.key&&(f+="&appid="+g.key);var h=function(a){var b=1e3*a,c=new Date(b),d=c.getHours();d>12&&(hoursRemaining=24-d,d=12-hoursRemaining);var e=c.getMinutes();e=e.toString(),e.length<2&&(e=0+e);var f=d+":"+e;return f};a.ajax({type:"GET",url:f,dataType:"jsonp",success:function(b){console.log(f);var c,d,j,k;switch(g.units){case"imperial":d="°F";break;case"metric":d="°C";break;case"standard":d="°K";break;default:d="°K"}if(c=Math.round(b.main.temp)+d,j=Math.round(b.main.temp_min)+d,k=Math.round(b.main.temp_max)+d,e.html(c),null!=g.minTemperatureTarget&&a(g.minTemperatureTarget).text(j),null!=g.maxTemperatureTarget&&a(g.maxTemperatureTarget).text(k),a(g.descriptionTarget).text(b.weather[0].description),null!=g.iconTarget&&null!=b.weather[0].icon){if(null!=g.customIcons){var m,n,l=b.weather[0].icon;n=l.indexOf("d")!=-1?"day":"night","01d"!=l&&"01n"!=l||(m="clear"),"02d"!=l&&"02n"!=l&&"03d"!=l&&"03n"!=l&&"04d"!=l&&"04n"!=l||(m="clouds"),"09d"!=l&&"09n"!=l&&"10d"!=l&&"10n"!=l||(m="rain"),"11d"!=l&&"11n"!=l||(m="storm"),"13d"!=l&&"13n"!=l||(m="snow"),"50d"!=l&&"50n"!=l||(m="mist");var o=g.customIcons+n+"/"+m+".png"}else var o="http://openweathermap.org/img/w/"+b.weather[0].icon+".png";a(g.iconTarget).attr("src",o)}if(null!=g.placeTarget&&a(g.placeTarget).text(b.name+", "+b.sys.country),null!=g.windSpeedTarget){var p;switch(g.windSpeedUnit){case"mps":p=b.wind.speed;break;case"Mph":p=b.wind.speed/.44704;break;case"Kph":p=3.6*b.wind.speed}if(a(g.windSpeedTarget).text(p.toFixed(1)+" "+g.windSpeedUnit),1==g.clickConvertWindSpeed){var q=0,r=a(g.windSpeedTarget).text().substring(0,2),s=["Kph","Mph","mps"];a(g.windSpeedTarget).on("click",function(b){q++;var d,c=s[q%s.length];d=i(g.windSpeedUnit,c,r),a(g.windSpeedTarget).text(d)})}}if(null!=g.windDirectionTarget){var t=b.wind.deg;if("degrees"===g.windDirectionUnit&&a(g.windDirectionTarget).text(t.toFixed(1)+"°"),"compass"===g.windDirectionUnit){var u=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"],v=null;a.isNumeric(t)&&t>=0&&(v=+Math.round((t/22.5+.5)%16),a(g.windDirectionTarget).text(u[v]))}else a(g.windDirectionTarget).text(t.toFixed(1)+"°")}if(null!=g.humidityTarget&&a(g.humidityTarget).text(b.main.humidity+"%"),null!=g.sunriseTarget){var w=h(b.sys.sunrise);a(g.sunriseTarget).text(w+" AM")}if(null!=g.sunsetTarget){var x=h(b.sys.sunset);a(g.sunsetTarget).text(x+" PM")}g.success.call(this)},error:function(a,b,c){g.error.call(this,b)}})}}(jQuery);
